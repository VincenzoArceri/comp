set show command off .
red setCounter(0) .
erewrite <_>_</_>(generatedTop, <_>_</_>(T, (<_>_</_>(threads, <_>_</_>(thread, (<_>_</_>(k, _`(_`)('__, _`,`,_(_`(_`)('semaphore_;, _`(_`)('_`,_, _`,`,_(_`(_`)(#token("Id", "pmutex"), .KList), _`(_`)('.List`{"`,"`}, .KList)))), _`(_`)('__, _`,`,_(_`(_`)('var_;, _`(_`)('_`,_, _`,`,_(_`(_`)(#token("Id", "bucket"), .KList), _`(_`)('_`,_, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)('.List`{"`,"`}, .KList)))))), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)(#_(0), .KList))), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "bucket"), .KList), _`(_`)(#_(50), .KList))), _`(_`)('__, _`,`,_(_`(_`)('_;, _`(_`)('execute_, _`(_`)('`{_`}, _`(_`)('__, _`,`,_(_`(_`)('var_;, _`(_`)('_`,_, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)('.List`{"`,"`}, .KList)))), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)(#_(0), .KList))), _`(_`)('while`(_`)_, _`,`,_(_`(_`)('_<=_, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)(#_(100), .KList))), _`(_`)('`{_`}, _`(_`)('__, _`,`,_(_`(_`)('lock_;, _`(_`)(#token("Id", "pmutex"), .KList)), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "bucket"), .KList), _`(_`)('_-_, _`,`,_(_`(_`)(#token("Id", "bucket"), .KList), _`(_`)(#_(1), .KList))))), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)('_+_, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)(#_(1), .KList))))), _`(_`)('__, _`,`,_(_`(_`)('unlock_;, _`(_`)(#token("Id", "pmutex"), .KList)), _`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)('_+_, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)(#_(1), .KList))))))))))))))))))))))), _`(_`)('__, _`,`,_(_`(_`)('_;, _`(_`)('execute_, _`(_`)('`{_`}, _`(_`)('__, _`,`,_(_`(_`)('var_;, _`(_`)('_`,_, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)('.List`{"`,"`}, .KList)))), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)(#_(0), .KList))), _`(_`)('while`(_`)_, _`,`,_(_`(_`)('_<=_, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)(#_(10000), .KList))), _`(_`)('`{_`}, _`(_`)('__, _`,`,_(_`(_`)('lock_;, _`(_`)(#token("Id", "pmutex"), .KList)), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "bucket"), .KList), _`(_`)('_+_, _`,`,_(_`(_`)(#token("Id", "bucket"), .KList), _`(_`)(#_(1), .KList))))), _`(_`)('__, _`,`,_(_`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)('_+_, _`,`,_(_`(_`)(#token("Id", "globalCounter"), .KList), _`(_`)(#_(1), .KList))))), _`(_`)('__, _`,`,_(_`(_`)('unlock_;, _`(_`)(#token("Id", "pmutex"), .KList)), _`(_`)('_=_;, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)('_+_, _`,`,_(_`(_`)(#token("Id", "counter"), .KList), _`(_`)(#_(1), .KList))))))))))))))))))))))), _`(_`)('print`(_`);, _`(_`)(#_("Spawned"), .KList)))))))))))))), k)) (<_>_</_>(env, .Map, env)) (<_>_</_>(holds, .Set, holds)) (<_>_</_>(id, _`(_`)(#_(0), .KList), id)) , thread), threads)) (<_>_</_>(genv, .Map, genv)) (<_>_</_>(store, .Map, store)) (<_>_</_>(streams, (<_>_</_>(in, __(ListItem(_`(_`)(#buffer, _`(_`)(#_(""), .KList))), .List, ListItem(_`(_`)('#istream`(_`), _`(_`)(#_(0), .KList)))), in)) (<_>_</_>(out, __(ListItem(_`(_`)('#ostream`(_`), _`(_`)(#_(1), .KList))), .List, ListItem(_`(_`)(#buffer, _`(_`)(#_(""), .KList)))), out)) , streams)) (<_>_</_>(busy, .Map, busy)) , T), generatedTop) .

red counter .